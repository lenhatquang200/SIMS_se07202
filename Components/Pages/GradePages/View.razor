@page "/grades/view"
@using Microsoft.EntityFrameworkCore
@using SIMS.Data
@rendermode InteractiveServer
@inject ApplicationDbContext Context
@inject NavigationManager NavigationManager

<PageTitle>View Grade</PageTitle>

<h1>View Grade</h1>

@if (enrollment == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="card">
        <div class="card-header">
            <h4>Student Information</h4>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Student Code:</dt>
                <dd class="col-sm-9">@enrollment.Student.Code</dd>

                <dt class="col-sm-3">Student Name:</dt>
                <dd class="col-sm-9">@enrollment.Student.Name</dd>

                <dt class="col-sm-3">Course:</dt>
                <dd class="col-sm-9">@enrollment.Course.Name</dd>

                <dt class="col-sm-3">Subject:</dt>
                <dd class="col-sm-9">@enrollment.Course.Subject.Name</dd>

                <dt class="col-sm-3">Semester:</dt>
                <dd class="col-sm-9">@enrollment.Course.Semester.Name</dd>

                <dt class="col-sm-3">Enrollment Date:</dt>
                <dd class="col-sm-9">@enrollment.EnrollmentDate.ToString("yyyy-MM-dd")</dd>

                <dt class="col-sm-3">Status:</dt>
                <dd class="col-sm-9">@enrollment.Status</dd>
            </dl>
        </div>
    </div>

    @if (grade != null)
    {
        <div class="card mt-3">
            <div class="card-header">
                <h4>Grade Information</h4>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Midterm Score:</dt>
                    <dd class="col-sm-9">@(grade.MidtermScore?.ToString("0.00") ?? "N/A")</dd>

                    <dt class="col-sm-3">Final Score:</dt>
                    <dd class="col-sm-9">@(grade.FinalScore?.ToString("0.00") ?? "N/A")</dd>

                    <dt class="col-sm-3">Total Score:</dt>
                    <dd class="col-sm-9">@(grade.TotalScore?.ToString("0.00") ?? "N/A")</dd>

                    <dt class="col-sm-3">Letter Grade:</dt>
                    <dd class="col-sm-9">@(grade.LetterGrade ?? "N/A")</dd>

                    <dt class="col-sm-3">Last Updated:</dt>
                    <dd class="col-sm-9">@(grade.UpdatedDate?.ToString("yyyy-MM-dd HH:mm") ?? "N/A")</dd>
                </dl>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-warning mt-3">
            No grade has been assigned yet.
        </div>
    }
}

<div class="mt-3">
    <a href="/grades" class="btn btn-secondary">Back to List</a>
</div>

@code {
    private Enrollment? enrollment;
    private Grade? grade;

    [Parameter]
    [SupplyParameterFromQuery]
    public int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        enrollment = await Context.Enrollments
            .Include(e => e.Student)
            .Include(e => e.Course)
                .ThenInclude(c => c.Subject)
            .Include(e => e.Course)
                .ThenInclude(c => c.Semester)
            .FirstOrDefaultAsync(e => e.Id == Id);

        if (enrollment != null)
        {
            grade = await Context.Grades
                .FirstOrDefaultAsync(g => g.EnrollmentId == enrollment.Id);
        }
    }
}

